<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PulseChat</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="/socket.io/socket.io.js"></script>
</head>
<body>
    <!-- Notification Sound -->
    <audio id="notificationSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTSKzPPLfi4IIYnN8++HNwgZZ7zr7Z1NEAxUq+Hsr2EYBC6J0vPPgjoIIw==" type="audio/wav">
    </audio>

    <!-- Mobile Navigation Overlay -->
    <div id="mobileNavOverlay" class="mobile-nav-overlay hidden">
        <div class="mobile-nav-backdrop"></div>
        <div class="mobile-nav-content">
            <div class="mobile-nav-header">
                <h2>PulseChat</h2>
                <button class="mobile-nav-close" id="mobileNavClose">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <!-- Mobile Friends Section -->
            <div class="mobile-friends-section">
                <!-- Friend Requests -->
                <div class="mobile-friend-requests-section">
                    <div class="mobile-subsection-header" onclick="toggleFriendRequests()">
                        <span class="mobile-subsection-title">
                            Friend Requests
                            <span id="mobileFriendRequestsBadge" class="badge hidden">0</span>
                        </span>
                        <button class="toggle-btn" id="mobileFriendRequestsToggle">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6,9 12,15 18,9"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div id="mobileFriendRequestsList" class="mobile-friend-requests-list">
                        <div class="empty-state">No pending friend requests</div>
                    </div>
                </div>
                
                <!-- Friends List -->
                <div class="mobile-friends-list-container">
                    <div class="mobile-section-header">
                        <h3>Friends</h3>
                        <button class="btn btn-small btn-primary" onclick="showFriendsManagement()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            Manage
                        </button>
                    </div>
                    <div class="mobile-friends-list" id="mobileFriendsList">
                        <div class="empty-state">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="9" cy="7" r="4"></circle>
                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                            </svg>
                            <p>No friends yet</p>
                            <p>Add some friends to start chatting!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile User Info Modal -->
    <div id="mobileUserInfoModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content mobile-user-modal">
            <div class="modal-header">
                <h2>User Profile</h2>
                <button class="btn-close" onclick="closeMobileUserInfo()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="mobile-user-profile">
                <div class="mobile-user-avatar" id="mobileUserAvatar">?</div>
                <h3 id="mobileUserName" class="mobile-user-name">Select a friend</h3>
                <span id="mobileUserRole" class="role-badge"></span>
            </div>
            
            <div class="mobile-user-details">
                <div class="detail-item">
                    <span class="detail-label">Friends Since</span>
                    <span class="detail-value" id="mobileFriendsSinceDate">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">User Tier</span>
                    <span class="detail-value" id="mobileFriendTier">-</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Role</span>
                    <span class="detail-value" id="mobileFriendRoleInfo">-</span>
                </div>
            </div>
            
            <div class="mobile-user-actions">
                <button class="btn btn-danger" id="mobileBlockBtn" onclick="blockUser()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M4.93 4.93l14.14 14.14"></path>
                    </svg>
                    Block User
                </button>
                
                <!-- Admin Actions -->
                <div class="admin-actions hidden" id="mobileAdminActions">
                    <div class="admin-section-title">Admin Actions</div>
                    
                    <div class="admin-action-group">
                        <label for="mobileMuteDuration">Mute Duration</label>
                        <select class="form-select" id="mobileMuteDuration">
                            <option value="1h">1 Hour</option>
                            <option value="1d">1 Day</option>
                            <option value="1w">1 Week</option>
                        </select>
                        <button class="btn btn-warning" onclick="muteUser()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                <line x1="23" y1="9" x2="17" y2="15"></line>
                                <line x1="17" y1="9" x2="23" y2="15"></line>
                            </svg>
                            Mute User
                        </button>
                    </div>
                    
                    <button class="btn btn-danger" onclick="showBanModal()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M10 2v20"></path>
                            <path d="M14 2v20"></path>
                            <path d="M4 7h16"></path>
                            <path d="M4 17h16"></path>
                        </svg>
                        Ban User
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Recording Modal -->
    <div id="voiceRecordingModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content voice-recording-modal">
            <div class="modal-header">
                <h2>Record Voice Message</h2>
                <button class="btn-close" onclick="cancelVoiceRecording()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="voice-recording-interface">
                <div class="recording-visualizer">
                    <div class="recording-icon" id="recordingIcon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                            <line x1="12" y1="19" x2="12" y2="23"></line>
                            <line x1="8" y1="23" x2="16" y2="23"></line>
                        </svg>
                    </div>
                    <div class="recording-status" id="recordingStatus">Click to start recording</div>
                    <div class="recording-timer" id="recordingTimer">00:00</div>
                </div>
                
                <div class="recording-controls">
                    <button class="btn btn-primary recording-btn" id="recordBtn" onclick="toggleRecording()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                        </svg>
                        Start Recording
                    </button>
                    
                    <button class="btn btn-secondary" id="playbackBtn" onclick="playRecording()" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="5,3 19,12 5,21"></polygon>
                        </svg>
                        Play
                    </button>
                    
                    <button class="btn btn-success" id="sendVoiceBtn" onclick="sendVoiceMessage()" disabled>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                        </svg>
                        Send
                    </button>
                </div>
                
                <div class="recording-info">
                    <p>Maximum recording time: 1 minute</p>
                    <p id="voiceUsageInfo">Voice messages remaining today: --</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Auto-login indicator -->
    <div id="autoLoginIndicator" class="auto-login-indicator hidden">
        <div class="login-content">
            <div class="pulse-logo">
                <div class="pulse-icon"></div>
                <h3>PulseChat</h3>
            </div>
            <p>Logging you in...</p>
            <div class="loading-spinner"></div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content auth-modal">
            <div class="auth-header">
                <div class="pulse-logo">
                    <div class="pulse-icon"></div>
                    <h2>PulseChat</h2>
                </div>
                <p>Welcome back! Sign in to continue</p>
            </div>
            
            <form class="auth-form">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <div class="auth-buttons">
                    <button type="button" class="btn btn-primary" onclick="login()">Sign In</button>
                    <button type="button" class="btn btn-secondary" onclick="showRegister()">Create Account</button>
                </div>
            </form>
            
            <div id="authMessage" class="message-display"></div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div id="registerModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content auth-modal">
            <div class="auth-header">
                <div class="pulse-logo">
                    <div class="pulse-icon"></div>
                    <h2>Join PulseChat</h2>
                </div>
                <p>Create your account to get started</p>
            </div>
            
            <form class="auth-form">
                <div class="form-group">
                    <label for="regUsername">Username</label>
                    <input type="text" id="regUsername" placeholder="Choose a username" required>
                </div>
                <div class="form-group">
                    <label for="regPassword">Password</label>
                    <input type="password" id="regPassword" placeholder="Create a secure password" required>
                </div>
                <div class="auth-buttons">
                    <button type="button" class="btn btn-primary" onclick="register()">Create Account</button>
                    <button type="button" class="btn btn-secondary" onclick="showLogin()">Back to Sign In</button>
                </div>
            </form>
            
            <div id="regMessage" class="message-display"></div>
        </div>
    </div>

    <!-- Friends Management Modal -->
    <div id="friendsManagementModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Manage Friends</h2>
                <button class="btn-close" onclick="closeFriendsManagement()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('addFriend')">Add Friend</button>
                <button class="tab-btn" onclick="switchTab('unblockUsers')">Unblock Users</button>
            </div>
            
            <div class="tab-content-container">
                <!-- Add Friend Tab -->
                <div id="addFriendTab" class="tab-content active">
                    <div class="form-group">
                        <label for="friendUsername">Username</label>
                        <input type="text" id="friendUsername" placeholder="Enter username to add">
                    </div>
                    <button class="btn btn-primary" onclick="sendFriendRequest()">Send Friend Request</button>
                    <div id="friendMessage" class="message-display"></div>
                </div>
                
                <!-- Unblock Users Tab -->
                <div id="unblockUsersTab" class="tab-content">
                    <div id="blockedUsersList" class="user-list">
                        <div class="empty-state">No blocked users</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="btn-close" onclick="closeSettings()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="settings-tabs">
                <button class="settings-tab-btn active" onclick="switchSettingsTab('profile')">Profile</button>
                <button class="settings-tab-btn" onclick="switchSettingsTab('preferences')">Settings</button>
                <button class="settings-tab-btn" onclick="switchSettingsTab('about')">About</button>
            </div>
            
            <div class="settings-content">
                <!-- Profile Tab -->
                <div id="profileTab" class="settings-tab-content active">
                    <div class="profile-info-section">
                        <h3 class="settings-section-title">Your Profile</h3>
                        
                        <div class="profile-info-card">
                            <div class="profile-info-item">
                                <div class="profile-info-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="12" cy="7" r="4"></circle>
                                    </svg>
                                    Username
                                </div>
                                <div class="profile-info-value" id="profileUsername">-</div>
                            </div>
                            
                            <div class="profile-info-item">
                                <div class="profile-info-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"></polygon>
                                    </svg>
                                    User Tier
                                </div>
                                <div class="profile-info-value">
                                    <span class="tier-badge" id="profileTier">-</span>
                                </div>
                            </div>
                            
                            <div class="profile-info-item">
                                <div class="profile-info-label">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 12l2 2 4-4"></path>
                                        <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                        <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                    </svg>
                                    Role
                                </div>
                                <div class="profile-info-value">
                                    <span class="role-badge" id="profileRole">-</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Daily Usage Section -->
                        <div class="usage-tracking-section">
                            <h4 class="settings-section-title">Today's Usage</h4>
                            <div class="usage-stats-grid" id="usageStatsGrid">
                                <!-- Usage stats will be populated by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="tier-benefits">
                            <h4 class="tier-benefits-title">Your Tier Benefits</h4>
                            <div class="tier-benefits-list" id="tierBenefitsList">
                                <!-- Benefits will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div id="preferencesTab" class="settings-tab-content">
                    <div class="settings-section">
                        <h3 class="settings-section-title">Preferences</h3>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <label for="allowFriendRequests">Allow Friend Requests</label>
                                <p>Let others send you friend requests</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="allowFriendRequests" checked>
                                <label for="allowFriendRequests" class="switch"></label>
                            </div>
                        </div>
                        
                        <div class="setting-item">
                            <div class="setting-info">
                                <label for="allowNotifications">Notification Sounds</label>
                                <p>Play sound when receiving messages while tab is not focused</p>
                            </div>
                            <div class="toggle-switch">
                                <input type="checkbox" id="allowNotifications" checked>
                                <label for="allowNotifications" class="switch"></label>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- About Tab -->
                <div id="aboutTab" class="settings-tab-content">
                    <div class="about-section">
                        <h3 class="settings-section-title">About PulseChat</h3>
                        
                        <div class="about-card">
                            <div class="about-header">
                                <div class="pulse-logo">
                                    <div class="pulse-icon"></div>
                                    <h4>PulseChat</h4>
                                </div>
                                <span class="version-badge">v1.2.0</span>
                            </div>
                            
                            <div class="about-content">
                                <div class="about-section-block">
                                    <h5>Tier System</h5>
                                    <div class="tier-info-blocks">
                                        <div class="tier-info-block">
                                            <h6>Tier 1 - Free</h6>
                                            <ul>
                                                <li><strong>Text messages:</strong> Unlimited</li>
                                                <li><strong>Pictures:</strong> 5 per day</li>
                                                <li><strong>Videos:</strong> 5 per day</li>
                                                <li><strong>Documents:</strong> 5 per day</li>
                                                <li><strong>Voice messages:</strong> 10 per day</li>
                                            </ul>
                                        </div>
                                        <div class="tier-info-block">
                                            <h6>Tier 2 - €5/month</h6>
                                            <ul>
                                                <li><strong>Text messages:</strong> Unlimited</li>
                                                <li><strong>Pictures:</strong> 15 per day</li>
                                                <li><strong>Videos:</strong> 10 per day</li>
                                                <li><strong>Documents:</strong> 25 per day</li>
                                                <li><strong>Voice messages:</strong> 50 per day</li>
                                            </ul>
                                        </div>
                                        <div class="tier-info-block">
                                            <h6>Tier 3 - €10/month</h6>
                                            <ul>
                                                <li><strong>Text messages:</strong> Unlimited</li>
                                                <li><strong>Pictures:</strong> 30 per day</li>
                                                <li><strong>Videos:</strong> 20 per day</li>
                                                <li><strong>Documents:</strong> 50 per day</li>
                                                <li><strong>Voice messages:</strong> 100 per day</li>
                                            </ul>
                                        </div>
                                    </div>
                                    <p><em>Admin, Developer, and Owner roles have Tier 3 privileges. Owner role has unlimited uploads.</em></p>
                                </div>
                                
                                <div class="about-section-block">
                                    <h5>Features</h5>
                                    <ul>
                                        <li><strong>Real-time messaging:</strong> Instant text communication with friends</li>
                                        <li><strong>Media sharing:</strong> Share images and videos (tier-based limits)</li>
                                        <li><strong>Voice messages:</strong> Record and send voice messages up to 1 minute</li>
                                        <li><strong>Document sharing:</strong> Share text documents up to 50KB</li>
                                        <li><strong>Friend system:</strong> Add friends and manage your social network</li>
                                        <li><strong>Privacy controls:</strong> Block users and manage friend requests</li>
                                    </ul>
                                </div>
                                
                                <div class="about-section-block">
                                    <h5>Privacy & Moderation</h5>
                                    <p>Due to the Digital Services Act and similar regulations across various countries, PulseChat operates as a <strong>strictly unmoderated</strong> chat platform. This means:</p>
                                    <ul>
                                        <li><strong>No message monitoring:</strong> Besides the exceptions listed below, not a single message is reviewed or monitored by our team</li>
                                        <li><strong>True privacy:</strong> Your conversations remain private between you and your friends</li>
                                    </ul>
                                </div>
                                
                                <div class="about-section-block warning-block">
                                    <h5>Enforcement Policy</h5>
                                    <p>Users <strong>can and will be banned</strong> for:</p>
                                    <ul>
                                        <li>Directly sharing forbidden or illegal material with owners or administrators</li>
                                        <li>Insulting, harassing, or threatening administrators or owners</li>
                                        <li>Attempting to exploit loopholes or vulnerabilities in the system</li>
                                    </ul>
                                    <p><em>These are the only exceptions to our non-moderation policy.</em></p>
                                </div>
                                
                                <div class="about-section-block">
                                    <h5>Data Security</h5>
                                    <ul>
                                        <li><strong>Complete deletion:</strong> When you delete messages, they are physically removed from our servers, not just hidden</li>
                                        <li><strong>Auto-deletion:</strong> All messages are automatically deleted after 48 hours</li>
                                        <li><strong>RAM-only IPs:</strong> IP addresses are only stored in RAM - if our server shuts down, all IP records are permanently lost</li>
                                        <li><strong>Encrypted storage:</strong> Only encrypted messages are stored on our backend systems</li>
                                    </ul>
                                </div>
                                
                                <div class="about-section-block">
                                    <h5>Contact</h5>
                                    <p>For technical support or account issues, contact your local administrator or owner.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="saveSettings()">Save Changes</button>
                <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
            </div>
            
            <div id="settingsMessage" class="message-display"></div>
        </div>
    </div>

    <!-- Ban Reason Modal -->
    <div id="banReasonModal" class="modal hidden">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ban User</h2>
                <button class="btn-close" onclick="closeBanModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="form-group">
                <label for="banReason">Reason (optional)</label>
                <textarea id="banReason" placeholder="Enter reason for ban..." rows="3"></textarea>
            </div>
            
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="confirmBan()">Ban User</button>
                <button class="btn btn-secondary" onclick="closeBanModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="app-container hidden" id="mainApp">
        <!-- Desktop Sidebar -->
        <aside class="sidebar" id="desktopSidebar">
            <!-- Friends Panel -->
            <div class="friends-section">
                <div class="section-header">
                    <h3>Friends</h3>
                    <button class="btn btn-small btn-primary" onclick="showFriendsManagement()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        Manage
                    </button>
                </div>
                
                <!-- Friend Requests -->
                <div class="friend-requests-section">
                    <div class="subsection-header" onclick="toggleFriendRequests()">
                        <span class="subsection-title">
                            Friend Requests
                            <span id="friendRequestsBadge" class="badge hidden">0</span>
                        </span>
                        <button class="toggle-btn" id="friendRequestsToggle">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6,9 12,15 18,9"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div id="friendRequestsList" class="friend-requests-list">
                        <div class="empty-state">No pending friend requests</div>
                    </div>
                </div>
                
                <!-- Friends List -->
                <div class="friends-list" id="friendsList">
                    <div class="empty-state">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <p>No friends yet</p>
                        <p>Add some friends to start chatting!</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="app-header">
                <div class="header-left">
                    <!-- Mobile Menu Button -->
                    <button class="mobile-menu-btn" id="mobileMenuBtn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    
                    <!-- Desktop Title -->
                    <h1 id="chatTitle" class="desktop-chat-title">Select a friend to start chatting</h1>
                    
                    <!-- Mobile User Profile Header -->
                    <div id="mobileUserHeader" class="mobile-user-header hidden" onclick="showMobileUserInfo()">
                        <div class="mobile-header-avatar" id="mobileHeaderAvatar">?</div>
                        <div class="mobile-header-info">
                            <div class="mobile-header-name" id="mobileHeaderName">Select a friend</div>
                            <div class="mobile-header-status" id="mobileHeaderStatus">Tap to view profile</div>
                        </div>
                        <div class="mobile-header-chevron">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9,18 15,12 9,6"></polyline>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <span id="currentUsername" class="username"></span>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-icon" onclick="showSettings()" title="Settings">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="3"></circle>
                                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                            </svg>
                        </button>
                        <button class="btn btn-icon btn-danger" onclick="confirmLogout()" title="Logout">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16,17 21,12 16,7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Chat Content -->
            <div class="chat-container">
                <!-- Messages Area -->
                <div class="messages-area">
                    <div class="messages-container" id="messagesContainer">
                        <div class="empty-state">
                            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <h3>Select a friend to view your conversation</h3>
                        </div>
                    </div>
                    
                    <!-- Message Input -->
                    <div class="message-input-area">
                        <div class="input-container">
                            <!-- Upload Actions Dropdown -->
                            <div class="upload-dropdown">
                                <button class="btn btn-icon upload-btn" id="uploadToggleBtn" onclick="toggleUploadMenu()" disabled title="Attach files">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66L9.64 16.2a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                                    </svg>
                                </button>
                                
                                <div class="upload-menu hidden" id="uploadMenu">
                                    <button class="upload-option" onclick="triggerImageUpload()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                            <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                            <polyline points="21,15 16,10 5,21"></polyline>
                                        </svg>
                                        Image/Video
                                    </button>
                                    
                                    <button class="upload-option" onclick="triggerDocumentUpload()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M14,2H6a2,2,0,0,0-2,2V20a2,2,0,0,0,2,2H18a2,2,0,0,0,2-2V8Z"></path>
                                            <polyline points="14,2 14,8 20,8"></polyline>
                                            <line x1="16" y1="13" x2="8" y2="13"></line>
                                            <line x1="16" y1="17" x2="8" y2="17"></line>
                                            <polyline points="10,9 9,9 8,9"></polyline>
                                        </svg>
                                        Document
                                    </button>
                                    
                                    <button class="upload-option" onclick="startVoiceRecording()">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                            <line x1="12" y1="19" x2="12" y2="23"></line>
                                            <line x1="8" y1="23" x2="16" y2="23"></line>
                                        </svg>
                                        Voice Message
                                    </button>
                                </div>
                            </div>
                            
                            <textarea 
                                class="message-input" 
                                id="messageInput" 
                                placeholder="Type a message..."
                                disabled
                                rows="1"
                                maxlength="250"
                            ></textarea>
                            <button class="btn btn-primary send-btn" id="sendBtn" onclick="sendMessage()" disabled>
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="22" y1="2" x2="11" y2="13"></line>
                                    <polygon points="22,2 15,22 11,13 2,9 22,2"></polygon>
                                </svg>
                            </button>
                        </div>
                        <div class="character-counter">
                            <span id="charCount">0</span> / <span id="maxChars">250</span>
                        </div>
                        
                        <!-- Hidden File Inputs -->
                        <input type="file" id="imageVideoInput" accept="image/*,video/*" style="display: none;" onchange="uploadImageVideo()">
                        <input type="file" id="documentInput" accept=".txt" style="display: none;" onchange="uploadDocument()">
                    </div>
                </div>

                <!-- User Info Panel (Desktop Only) -->
                <aside class="user-info-panel hidden" id="userInfoPanel">
                    <div class="user-profile">
                        <div class="user-avatar" id="friendAvatar">?</div>
                        <h3 id="friendInfoUsername" class="user-name">Select a friend</h3>
                        <span id="friendInfoRole" class="role-badge"></span>
                    </div>
                    
                    <div class="user-details">
                        <div class="detail-item">
                            <span class="detail-label">Friends Since</span>
                            <span class="detail-value" id="friendsSinceDate">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">User Tier</span>
                            <span class="detail-value" id="friendTier">-</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Role</span>
                            <span class="detail-value" id="friendRoleInfo">-</span>
                        </div>
                    </div>
                    
                    <div class="user-actions">
                        <button class="btn btn-danger" id="blockBtn" onclick="blockUser()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M4.93 4.93l14.14 14.14"></path>
                            </svg>
                            Block User
                        </button>
                        
                        <!-- Admin Actions -->
                        <div class="admin-actions hidden" id="adminActions">
                            <div class="admin-section-title">Admin Actions</div>
                            
                            <div class="admin-action-group">
                                <label for="muteDuration">Mute Duration</label>
                                <select class="form-select" id="muteDuration">
                                    <option value="1h">1 Hour</option>
                                    <option value="1d">1 Day</option>
                                    <option value="1w">1 Week</option>
                                </select>
                                <button class="btn btn-warning" onclick="muteUser()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                        <line x1="23" y1="9" x2="17" y2="15"></line>
                                        <line x1="17" y1="9" x2="23" y2="15"></line>
                                    </svg>
                                    Mute User
                                </button>
                            </div>
                            
                            <button class="btn btn-danger" onclick="showBanModal()">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M10 2v20"></path>
                                    <path d="M14 2v20"></path>
                                    <path d="M4 7h16"></path>
                                    <path d="M4 17h16"></path>
                                </svg>
                                Ban User
                            </button>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <script src="script.js"></script>
</body>
</html>